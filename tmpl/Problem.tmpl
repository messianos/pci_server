
<% c++ #include "ViewContent.h" %>

<% skin pci_skin %>
	<% view problem_view uses ViewContent::ProblemContent extends template_view %>
	
	
		<% template css_links() %>
			<% include template_view::css_links() %>
			<link href="/css/problem.css" rel="stylesheet" type="text/css" />
		<% end template %>
		
		<% template js_links() %>
			<% include template_view::js_links() %>
			<script src="/lib/ckeditor/ckeditor.js"></script>
		<% end template %>
	
		<% template javascript_code() %>
			<% include template_view::javascript_code() %>
			<script>

				// Toggles elements involved in edition
				function toggle(){
					$("#problem_edit_button").toggle();
					$("#pci_problem_problem_content").toggle();
					$("#problem_cancel_edit_button").toggle();
					$("#problem_finish_edit_button").toggle();
					$("#ckeditor_container").toggle();				
				}
				
				$(document).ready(function(){
					configureTexteditor("pci_textfield");

					$("#ckeditor_container").hide();
					$("#problem_cancel_edit_button").hide();
					$("#problem_finish_edit_button").hide();
					$("#problem_edit_button").click(function(){
						toggle();
					});
	
					$("#problem_cancel_edit_button").click(function(){
						toggle();
					});
	
					$("#problem_finish_edit_button").click(function(){
						toggle();
						alert('Edition submit dumb method to be replaced with AJAX');
					});
				});
			</script>
		<% end template %>	
	
		<% template page_content() %>
			<% include template_view::header_bar() %>
			<% include template_view::navigation_menu() %>
			<div id="pci_problem_main_container">
				<div class="pci_box_container">
					<% if user_signed_in %>
						<% include template_view::toolbar_problem(problem->id) %>
						<div class="pci_horizontal_line"></div>
					<% end %>
					<div id="pci_problem_header_container">
						<a id="problem_edit_button">
							<div class="pci_button_classic">
								Editar
							</div>
						</a>
						<h2>
							<%= problem->description %>
						</h2>
						<span class="pci_text_description">
							<% if problem->is_anonymous %>
								<i>Publicado An√≥nimamente</i>
							<% else %>
								<i>Por <a class="pci_link_user_name" href="<% url "/user" using problem->creator_user_name %>"><%= problem->creator_user_name %></a></i>
							<% end %>
							- <%= problem->creation_datetime->toString("%d/%m/%Y a las %H:%M hs.") %>
						</span>
					</div>
					<div id="pci_problem_problem_container">
						<div id="ckeditor_container">
						<textfield id="pci_textfield"></textfield>
						</div>
						<a id="problem_finish_edit_button">
							<div class="pci_button_classic">
								Finalizar
							</div>
						</a>
						<a id="problem_cancel_edit_button">
							<div class="pci_button_classic">
								Cancelar
							</div>
						</a>
						<div class="pci_box_content" id="pci_problem_problem_content">
							<%= problem->content %>
						</div>
					</div>
					<div id="pci_problem_solution_container">
						<% if problem->is_solved  %>
							<div class="pci_box_description pci_problem_solution_description" style="background-color:#ABFFAB;">
								<% include template_view::solution_description(problem, accepted_solution) %>
							</div>
						<% end %>
						<% foreach solution in *solutions %>
		 					<% item %>
		 						<% if (!content.problem->is_solved || solution->id.compare(content.accepted_solution->id) != 0) %>
									<div class="pci_box_description pci_problem_solution_description">
										<% include template_view::solution_description(problem, solution) %>
									</div>
								<% end %>
		  					<% end %>
						<% end %>
					</div>
					<% include template_view::clarifications(clarifications, problem) %>
				</div>
			</div>
		<% end template %>
		
	
	<% end view %>
<% end skin %>
